{% extends "snapboard/base_forum.html" %}
{% load i18n pagination_tags %}

{% block extra_head %}
    {{ block.super }}
    <link type="text/css" rel="stylesheet" href="{{ SNAP_MEDIA_PREFIX }}/css/post.css" />
<!-- Load jQuery build -->
<script type="text/javascript" src="{{ MEDIA_URL }}js/tiny_mce/jquery.tinymce.js"></script>
<script type="text/javascript">
$().ready(function() {
	$('#id_post').tinymce({
		script_url : '{{ MEDIA_URL }}js/tiny_mce/tiny_mce.js',
		// General options
		theme : "advanced",
		theme_advanced_toolbar_location : "top",
		theme_advanced_toolbar_align : "left",
		theme_advanced_statusbar_location : "bottom",
		theme_advanced_resizing : true,
		content_css : "/site_media/base.css",
//		hide : true
	});
//	$('#id_post').hide();
});
</script>
{% endblock %}

{% load extras %}

{% block snapboard_header %}
        <b style="font-size: large;">
            <a href="{% url snapboard_board_post_index p.board.id %}">{{ p.board }}</a>:
            {{ p.subject }}
        </b><br />
                    <span class="post_menuright">
                {% if user.is_authenticated  %}
                <span class="popup">
                    <a href="#post_form" onclick="return do_quote('{{ post.id }}');">{% trans "quote" %}</a>
                </span>
                {% endif %}
                {% ifequal post.user_id user.id %}
                &#149;
                <span title="{% trans "Edit this post.  All revisions are saved!" %}" class="popup">
                    <a href="{% url snapboard_edit_post post.id %}">{% trans "edit post" %}</a>
                </span>
                {% endifequal %}
                {% if user.is_staff %}
                &#149;
                <span title="{% trans "ADMIN: mark this post for censorship" %}" class="popup">
                    <a id="censor{{ post.id }}" href="#snap_post{{ post.id }}" onclick="set_censor('{{ post.id }}');">
                        {{ post.censor|yesno:_("uncensor,censor") }}
                    </a>
                </span>
                {% endif %}
                {% if user.is_authenticated and not post.freespeech %}
                &#149;
                <span title="{% trans "Report this post for violation of forum policies." %}" class="popup">
                    <a id="abuse{{ post.id }}" href="#snap_post{{ post.id }}" onclick="set_abuse('{{ post.id }}');">{% trans "report abuse" %}</a>
                </span>
                {% endif %}
            </span>

            {% if post.avatar %}
                <img src="{{ SNAP_MEDIA_PREFIX }}/{{ post.avatar }}" />
            {% endif %}
            <b>
                <a href="{% url profile_detail post.user.username %}">
                    <span class="popup" title="Author">{% if post.user.get_profile %}
	{% if post.user.get_profile.nickname %}
	{{ post.user.get_profile.nickname }}
	{% endif %}
	{% if not post.user.get_profile.nickname %}
	{{ post.user.username }}
	{% endif %}
	{% endif %}
	{% if not post.user.get_profile %}
	{{ post.user.username }}
	{% endif %}
	({{ post.user.username }})</span></a>
            </b>

            {% if post.private.all %}
                {% trans "to" %} {% for rec in post.private.all %}
                {{ rec }}{% if not forloop.last %},{% endif %}
                {% endfor %}
            {% endif %}

            <span class="timesince">
                <span class="datetime">{{ post.date|date:"r T" }}<span class="timestamp">{{ post.date|timestamp }}</span></span>
            </span>
            {% comment %}
            <span class="post_summary" style="display:none;" id="snap_post_sum{{ post.id }}">:
                {{ post.text|post_summary:"30"|safe }}
            </span>
        	{% endcomment %}
{% endblock %}
{% block snapboard_main %}
    <div id="thread_rpc_feedback" class="rpc_message">
        <!-- This DIV is for RPC feedback messages for the whole thread-->
    </div>
    <p>
        <span class="thread_menu">
            {% if user.is_staff %}
                <span>
                    <a id="csticky{{ p.id }}" href="#" onclick="set_csticky('{{ p.id }}');">
                        {{ p.csticky|yesno:_("unset csticky,set csticky") }}
                    </a> 
                </span>
                &#149;
                <span>
                    <a id="gsticky{{ p.id }}" href="#" onclick="set_gsticky('{{ p.id }}');">
                        {{ p.gsticky|yesno:_("unset gsticky,set gsticky") }}
                    </a> 
                </span>
                &#149;
                <span>
                    <a id="close{{ p.id }}" href="#" onclick="set_close('{{ p.id }}');">
                        {{ p.closed|yesno:_("open post,close post") }}
                    </a> 
                </span>
            {% endif %}
            {% if user.is_authenticated %}
                &#149;
                <span>
                    <a id="watch{{ p.id }}" href="#" onclick="set_watch('{{ p.id }}');">
                        {{ watched|yesno:_("don't watch,watch") }}
                    </a> 
                </span>
            {% endif %}
        </span>
    </p>

    {% include "snapboard/include/show_posts.html" %}

    <br />

{% endblock %}
